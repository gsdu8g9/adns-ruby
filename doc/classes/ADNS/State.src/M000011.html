<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>
<head>
  <title>submit_reverse_any (ADNS::State)</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <link rel="stylesheet" href="../../.././rdoc-style.css" type="text/css" media="screen" />
</head>
<body class="standalone-code">
  <pre>/*
 * call-seq: submit_reverse_any(ip_addr, type[, qflags])        =&gt; ADNS::Query instance
 * 
 * Submit asynchronous request to reverse lookup address &lt;ipaddr&gt; using optional query flags &lt;qflags&gt;.
 * Note: &lt;type&gt; can any resource record.  
 */
static VALUE cState_submit_reverse_any(int argc, VALUE argv[], VALUE self)
{
        VALUE query; /* return instance */
        rb_adns_query_t *rb_adq_r = ALLOC(rb_adns_query_t);
        const char *owner;
        struct sockaddr_in addr;
        const char *zone; /* in-addr.arpa or any other reverse zones */
    adns_rrtype type = adns_r_none;
        adns_queryflags qflags = adns_qf_owner;
        int idx, ecode;
   
    Data_Get_Struct(self, rb_adns_state_t, rb_adq_r-&gt;rb_ads_r);
        if (argc &lt; 3)
                rb_raise(rb_eArgError, &quot;wrong number of arguments (%d for 3)&quot;, argc);
    if (argc &gt; 4)
        rb_raise(rb_eArgError, &quot;excess number of arguments (%d for 4)&quot;, argc);
    CHECK_TYPE(argv[0], T_STRING); /* IP */
    CHECK_TYPE(argv[1], T_STRING); /* Zone */
    CHECK_TYPE(argv[2], T_FIXNUM); /* RR */
        if (argc == 4)
                CHECK_TYPE(argv[3], T_FIXNUM); /* )); */
    owner = STR2CSTR(argv[0]);
    zone = STR2CSTR(argv[1]);
        type = FIX2INT(argv[2]);
    if (argc == 4)
        qflags |= FIX2INT(argv[3]);
        addr.sin_family = AF_INET;
        ecode = inet_aton(owner, &amp;addr.sin_addr);
        if (ecode == 0)
                rb_raise(mADNS__eQueryError, &quot;invalid ip address&quot;);
        rb_adq_r-&gt;answer = Qnil;
        query = Data_Wrap_Struct(mADNS__cQuery, cQuery_mark, cQuery_free, rb_adq_r);
        rb_obj_call_init(query, 0, 0);
    ecode = adns_submit_reverse_any(rb_adq_r-&gt;rb_ads_r-&gt;ads, (struct sockaddr*)&amp;addr,
                                                                zone, type, qflags, (void *)query, &amp;rb_adq_r-&gt;adq);
        if (ecode)
                rb_raise(mADNS__eError, strerror(ecode));
    return query;
}</pre>
</body>
</html>