<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>
<head>
  <title>new (ADNS::State)</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <link rel="stylesheet" href="../../.././rdoc-style.css" type="text/css" media="screen" />
</head>
<body class="standalone-code">
  <pre>/*
 * call-seq: new([iflags, filename, filemode])  =&gt; ADNS::State object
 *
 * Create new ADNS::State object and initialize adns library using optional initialization
 * flags &lt;iflags&gt;, debug log to filename &lt;filename&gt; (*only available if ADNS::IF::DEBUG flag is given*),
 * debug log filemode &lt;filemode&gt;.
 */
static VALUE cState_new(int argc, VALUE argv[], VALUE self)
{
    VALUE state; /* return instance */
    rb_adns_state_t *rb_ads_r = ALLOC(rb_adns_state_t);
    rb_ads_r-&gt;ads = NULL;
    rb_ads_r-&gt;diagfile = NULL;
        adns_initflags iflags = adns_if_none;
    const char *fname, *fmode;
        
        if (argc &gt; 3)
                rb_raise(rb_eArgError, &quot;excess number of arguments (%d for 3)&quot;, argc);
        if (argc &gt;= 1)
        {
        CHECK_TYPE(argv[0], T_FIXNUM);
        iflags |= FIX2INT(argv[0]);
        if (argc &gt;= 2)
        {
                CHECK_TYPE(argv[1], T_STRING);
                fname = STR2CSTR(argv[1]);
                if (argc == 3)
                {
                        CHECK_TYPE(argv[2], T_STRING);
                        fmode = STR2CSTR(argv[2]);
                        } else
                                fmode = DEFAULT_DIAG_FILEMODE;
                rb_ads_r-&gt;diagfile = fopen(fname, fmode);
                if (!rb_ads_r-&gt;diagfile)
                        rb_raise(rb_eIOError, &quot;%s - %s&quot;, strerror(errno), fname);
                }
        }
    adns_init(&amp;rb_ads_r-&gt;ads, iflags, rb_ads_r-&gt;diagfile);
    state = Data_Wrap_Struct(mADNS__cState, cState_mark, cState_free, rb_ads_r);
    rb_obj_call_init(state, 0, 0);
    return state;
}</pre>
</body>
</html>