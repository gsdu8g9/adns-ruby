<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>
<head>
  <title>completed_queries (ADNS::State)</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <link rel="stylesheet" href="../../.././rdoc-style.css" type="text/css" media="screen" />
</head>
<body class="standalone-code">
  <pre>/*
 * call-seq: completed()        =&gt; Array
 *
 * Returns an array of all the completed (ADNS::Query) queries submitted using ADNS::State.submit_*() methods.
 */
static VALUE cState_completed_queries(int argc, VALUE argv[], VALUE self)
{
        VALUE a1, query_list = rb_ary_new();
        VALUE query_ctx; /* ADNS::Query context passed from one of the submit_* */
    rb_adns_state_t *rb_ads_r;
        rb_adns_query_t *rb_adq_r;
    adns_query adq;
    adns_answer *answer_r;
    double timeout;
    int ecode;

        if (argc == 1)
        {
                a1 = argv[0];
                CHECK_TYPE(a1, T_FLOAT);
        }
        else
                a1 = rb_float_new(0.0);
    timeout = (double) RFLOAT_VALUE(a1);
    Data_Get_Struct(self, rb_adns_state_t, rb_ads_r);
        (void) adns_select_timeout(rb_ads_r, timeout);
    for (adns_forallqueries_begin(rb_ads_r-&gt;ads);
         (adq = adns_forallqueries_next(rb_ads_r-&gt;ads, 0)) != 0;)
    {
        ecode = adns_check(rb_ads_r-&gt;ads, &amp;adq, &amp;answer_r, (void **)&amp;query_ctx);
        if (ecode)
            if (ecode == EWOULDBLOCK)
                continue;
                Data_Get_Struct(query_ctx, rb_adns_query_t, rb_adq_r);
                rb_adq_r-&gt;answer = rb_hash_new();
                rb_hash_aset(rb_adq_r-&gt;answer, CSTR2SYM(&quot;type&quot;), INT2FIX(answer_r-&gt;type));
                rb_hash_aset(rb_adq_r-&gt;answer, CSTR2SYM(&quot;owner&quot;), CSTR2STR(answer_r-&gt;owner));
                rb_hash_aset(rb_adq_r-&gt;answer, CSTR2SYM(&quot;status&quot;), INT2FIX(answer_r-&gt;status));
                rb_hash_aset(rb_adq_r-&gt;answer, CSTR2SYM(&quot;expires&quot;), INT2FIX(answer_r-&gt;expires));
                rb_hash_aset(rb_adq_r-&gt;answer, CSTR2SYM(&quot;answer&quot;), parse_adns_answer(answer_r));
                rb_adq_r-&gt;adq = NULL;
                free(answer_r);
        rb_ary_push(query_list, query_ctx);
    }
    return query_list;
}</pre>
</body>
</html>