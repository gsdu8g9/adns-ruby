<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>
<head>
  <title>synchronous (ADNS::State)</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <link rel="stylesheet" href="../../.././rdoc-style.css" type="text/css" media="screen" />
</head>
<body class="standalone-code">
  <pre>/*
 * call-seq: synchronous(domain, type[, qflags]) =&gt; Hash
 *
 * Submit synchronous request to resolve domain &lt;domain&gt; of record type &lt;type&gt; using optional query flags &lt;qflags&gt;.
 */
static VALUE cState_synchronous(int argc, VALUE argv[], VALUE self)
{
        VALUE answer = rb_hash_new(); /* return instance */
        rb_adns_state_t *rb_ads_r;
        adns_answer *answer_r;
        adns_queryflags qflags = adns_qf_owner;
        adns_rrtype type = adns_r_none;
        const char *owner;
        int ecode;
    
        Data_Get_Struct(self, rb_adns_state_t, rb_ads_r);
    if (argc &lt; 2)
        rb_raise(rb_eArgError, &quot;wrong number of arguments (%d for 2)&quot;, argc);
    if (argc &gt; 3)
        rb_raise(rb_eArgError, &quot;excess number of arguments (%d for 3)&quot;, argc);
    CHECK_TYPE(argv[0], T_STRING); /* DOMAIN */
    CHECK_TYPE(argv[1], T_FIXNUM); /* RR */
    if (argc == 3)
        CHECK_TYPE(argv[2], T_FIXNUM); /* QFlags */
        owner = STR2CSTR(argv[0]);
        type = FIX2INT(argv[1]);
    if (argc == 3)
        qflags |= FIX2INT(argv[2]);
        ecode = adns_synchronous(rb_ads_r-&gt;ads, owner, type, qflags, &amp;answer_r);
        if (ecode)
                rb_raise(mADNS__eError, adns_strerror(ecode));
        /* populate return hash */
        rb_hash_aset(answer, CSTR2SYM(&quot;type&quot;), INT2FIX(answer_r-&gt;type));
        rb_hash_aset(answer, CSTR2SYM(&quot;owner&quot;), CSTR2STR(answer_r-&gt;owner));
        rb_hash_aset(answer, CSTR2SYM(&quot;status&quot;), INT2FIX(answer_r-&gt;status));
        rb_hash_aset(answer, CSTR2SYM(&quot;expires&quot;), INT2FIX(answer_r-&gt;expires));
        rb_hash_aset(answer, CSTR2SYM(&quot;answer&quot;), Qnil);
        if (answer_r-&gt;nrrs == 0)
                return answer;
        else
                rb_hash_aset(answer, CSTR2SYM(&quot;answer&quot;), parse_adns_answer(answer_r));
        return answer;
}</pre>
</body>
</html>